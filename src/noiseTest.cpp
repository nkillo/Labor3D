
       static float gradients3d[256] = 
        {
            0, 1, 1, 0,  0,-1, 1, 0,  0, 1,-1, 0,  0,-1,-1, 0,
            1, 0, 1, 0, -1, 0, 1, 0,  1, 0,-1, 0, -1, 0,-1, 0,
            1, 1, 0, 0, -1, 1, 0, 0,  1,-1, 0, 0, -1,-1, 0, 0,
            0, 1, 1, 0,  0,-1, 1, 0,  0, 1,-1, 0,  0,-1,-1, 0,
            1, 0, 1, 0, -1, 0, 1, 0,  1, 0,-1, 0, -1, 0,-1, 0,
            1, 1, 0, 0, -1, 1, 0, 0,  1,-1, 0, 0, -1,-1, 0, 0,
            0, 1, 1, 0,  0,-1, 1, 0,  0, 1,-1, 0,  0,-1,-1, 0,
            1, 0, 1, 0, -1, 0, 1, 0,  1, 0,-1, 0, -1, 0,-1, 0,
            1, 1, 0, 0, -1, 1, 0, 0,  1,-1, 0, 0, -1,-1, 0, 0,
            0, 1, 1, 0,  0,-1, 1, 0,  0, 1,-1, 0,  0,-1,-1, 0,
            1, 0, 1, 0, -1, 0, 1, 0,  1, 0,-1, 0, -1, 0,-1, 0,
            1, 1, 0, 0, -1, 1, 0, 0,  1,-1, 0, 0, -1,-1, 0, 0,
            0, 1, 1, 0,  0,-1, 1, 0,  0, 1,-1, 0,  0,-1,-1, 0,
            1, 0, 1, 0, -1, 0, 1, 0,  1, 0,-1, 0, -1, 0,-1, 0,
            1, 1, 0, 0, -1, 1, 0, 0,  1,-1, 0, 0, -1,-1, 0, 0,
            1, 1, 0, 0,  0,-1, 1, 0, -1, 1, 0, 0,  0,-1,-1, 0
        };

                
       static float gradients2d[256] = 
        {
            0.130526192220052f, 0.99144486137381f, 0.38268343236509f, 0.923879532511287f, 0.608761429008721f, 0.793353340291235f, 0.793353340291235f, 0.608761429008721f,
            0.923879532511287f, 0.38268343236509f, 0.99144486137381f, 0.130526192220051f, 0.99144486137381f, -0.130526192220051f, 0.923879532511287f, -0.38268343236509f,
            0.793353340291235f, -0.60876142900872f, 0.608761429008721f, -0.793353340291235f, 0.38268343236509f, -0.923879532511287f, 0.130526192220052f, -0.99144486137381f,
            -0.130526192220052f, -0.99144486137381f, -0.38268343236509f, -0.923879532511287f, -0.608761429008721f, -0.793353340291235f, -0.793353340291235f, -0.608761429008721f,
            -0.923879532511287f, -0.38268343236509f, -0.99144486137381f, -0.130526192220052f, -0.99144486137381f, 0.130526192220051f, -0.923879532511287f, 0.38268343236509f,
            -0.793353340291235f, 0.608761429008721f, -0.608761429008721f, 0.793353340291235f, -0.38268343236509f, 0.923879532511287f, -0.130526192220052f, 0.99144486137381f,
            0.130526192220052f, 0.99144486137381f, 0.38268343236509f, 0.923879532511287f, 0.608761429008721f, 0.793353340291235f, 0.793353340291235f, 0.608761429008721f,
            0.923879532511287f, 0.38268343236509f, 0.99144486137381f, 0.130526192220051f, 0.99144486137381f, -0.130526192220051f, 0.923879532511287f, -0.38268343236509f,
            0.793353340291235f, -0.60876142900872f, 0.608761429008721f, -0.793353340291235f, 0.38268343236509f, -0.923879532511287f, 0.130526192220052f, -0.99144486137381f,
            -0.130526192220052f, -0.99144486137381f, -0.38268343236509f, -0.923879532511287f, -0.608761429008721f, -0.793353340291235f, -0.793353340291235f, -0.608761429008721f,
            -0.923879532511287f, -0.38268343236509f, -0.99144486137381f, -0.130526192220052f, -0.99144486137381f, 0.130526192220051f, -0.923879532511287f, 0.38268343236509f,
            -0.793353340291235f, 0.608761429008721f, -0.608761429008721f, 0.793353340291235f, -0.38268343236509f, 0.923879532511287f, -0.130526192220052f, 0.99144486137381f,
            0.130526192220052f, 0.99144486137381f, 0.38268343236509f, 0.923879532511287f, 0.608761429008721f, 0.793353340291235f, 0.793353340291235f, 0.608761429008721f,
            0.923879532511287f, 0.38268343236509f, 0.99144486137381f, 0.130526192220051f, 0.99144486137381f, -0.130526192220051f, 0.923879532511287f, -0.38268343236509f,
            0.793353340291235f, -0.60876142900872f, 0.608761429008721f, -0.793353340291235f, 0.38268343236509f, -0.923879532511287f, 0.130526192220052f, -0.99144486137381f,
            -0.130526192220052f, -0.99144486137381f, -0.38268343236509f, -0.923879532511287f, -0.608761429008721f, -0.793353340291235f, -0.793353340291235f, -0.608761429008721f,
            -0.923879532511287f, -0.38268343236509f, -0.99144486137381f, -0.130526192220052f, -0.99144486137381f, 0.130526192220051f, -0.923879532511287f, 0.38268343236509f,
            -0.793353340291235f, 0.608761429008721f, -0.608761429008721f, 0.793353340291235f, -0.38268343236509f, 0.923879532511287f, -0.130526192220052f, 0.99144486137381f,
            0.130526192220052f, 0.99144486137381f, 0.38268343236509f, 0.923879532511287f, 0.608761429008721f, 0.793353340291235f, 0.793353340291235f, 0.608761429008721f,
            0.923879532511287f, 0.38268343236509f, 0.99144486137381f, 0.130526192220051f, 0.99144486137381f, -0.130526192220051f, 0.923879532511287f, -0.38268343236509f,
            0.793353340291235f, -0.60876142900872f, 0.608761429008721f, -0.793353340291235f, 0.38268343236509f, -0.923879532511287f, 0.130526192220052f, -0.99144486137381f,
            -0.130526192220052f, -0.99144486137381f, -0.38268343236509f, -0.923879532511287f, -0.608761429008721f, -0.793353340291235f, -0.793353340291235f, -0.608761429008721f,
            -0.923879532511287f, -0.38268343236509f, -0.99144486137381f, -0.130526192220052f, -0.99144486137381f, 0.130526192220051f, -0.923879532511287f, 0.38268343236509f,
            -0.793353340291235f, 0.608761429008721f, -0.608761429008721f, 0.793353340291235f, -0.38268343236509f, 0.923879532511287f, -0.130526192220052f, 0.99144486137381f,
            0.130526192220052f, 0.99144486137381f, 0.38268343236509f, 0.923879532511287f, 0.608761429008721f, 0.793353340291235f, 0.793353340291235f, 0.608761429008721f,
            0.923879532511287f, 0.38268343236509f, 0.99144486137381f, 0.130526192220051f, 0.99144486137381f, -0.130526192220051f, 0.923879532511287f, -0.38268343236509f,
            0.793353340291235f, -0.60876142900872f, 0.608761429008721f, -0.793353340291235f, 0.38268343236509f, -0.923879532511287f, 0.130526192220052f, -0.99144486137381f,
            -0.130526192220052f, -0.99144486137381f, -0.38268343236509f, -0.923879532511287f, -0.608761429008721f, -0.793353340291235f, -0.793353340291235f, -0.608761429008721f,
            -0.923879532511287f, -0.38268343236509f, -0.99144486137381f, -0.130526192220052f, -0.99144486137381f, 0.130526192220051f, -0.923879532511287f, 0.38268343236509f,
            -0.793353340291235f, 0.608761429008721f, -0.608761429008721f, 0.793353340291235f, -0.38268343236509f, 0.923879532511287f, -0.130526192220052f, 0.99144486137381f,
            0.38268343236509f, 0.923879532511287f, 0.923879532511287f, 0.38268343236509f, 0.923879532511287f, -0.38268343236509f, 0.38268343236509f, -0.923879532511287f,
            -0.38268343236509f, -0.923879532511287f, -0.923879532511287f, -0.38268343236509f, -0.923879532511287f, 0.38268343236509f, -0.38268343236509f, 0.923879532511287f,
        };


inline float noiseLerp(float x, float a, float b){
    return a + x * (b - a);
}

//fade function by ken perlin, eases coordinate values so that they will 'ease' towards integral values. this ends up smoothing the final output
inline float noiseFade(float t){
    return t * t * t * (t * (t * 6 - 15) + 10); //6t^5 - 15t^4 + 10t^3;
}

static float fnlFastFloor(float f) {return (f >= 0 ? (int)f : (int)f - 1);}

// static const int PRIME_X = 501125321;
// static const int PRIME_Y = 1136930381;
// static const int PRIME_Z = 1720413743;

#define PRIME_X 501125321
#define PRIME_Y 1136930381
#define PRIME_Z 1720413743

static inline float fnlHash3d(int xPrimed, int yPrimed, int zPrimed, int seed = 12345){
    int hash = seed ^ xPrimed ^ yPrimed ^ zPrimed;
    hash *= 0x27d4eb2d;
    return hash;
}

static inline float fnlHash2d(int xPrimed, int yPrimed, int seed = 12345){
    int hash = seed ^ xPrimed ^ yPrimed;
    hash *= 0x27d4eb2d;
    return hash;
}

static inline float fnlGradCoord3d( int xPrimed, int yPrimed, int zPrimed, float xd, float yd, float zd, int seed = 12345){
    int hash = fnlHash3d(xPrimed, yPrimed, zPrimed, seed);
    hash ^= hash >> 15;
    hash &= 63 << 2;
    return xd * gradients3d[hash] + yd * gradients3d[hash | 1] + zd * gradients3d[hash | 2];
}

static inline float fnlGradCoord2d( int xPrimed, int yPrimed, float xd, float yd, int seed = 12345){
    int hash = fnlHash2d(xPrimed, yPrimed, seed);
    hash ^= hash >> 15;
    hash &= 63 << 1;
    return xd * gradients2d[hash] + yd * gradients2d[hash | 1];
}


float fnlPerlin3d( vec3 vec){
    int x0 = (vec.x >= 0 ? (int)vec.x : (int)vec.x - 1);
    int y0 = (vec.y >= 0 ? (int)vec.y : (int)vec.y - 1);
    int z0 = (vec.z >= 0 ? (int)vec.z : (int)vec.z - 1);
    
    float xf0 = (float)(vec.x - x0);
    float yf0 = (float)(vec.y - y0);
    float zf0 = (float)(vec.z - z0);
    float xf1 = xf0 - 1;
    float yf1 = yf0 - 1;
    float zf1 = zf0 - 1;

    float xs = noiseFade(xf0);
    float ys = noiseFade(yf0);
    float zs = noiseFade(zf0);
    
    x0 *= PRIME_X;
    y0 *= PRIME_Y;
    z0 *= PRIME_Z;

    int x1 = x0 + PRIME_X;
    int y1 = y0 + PRIME_Y;
    int z1 = z0 + PRIME_Z;

    int seed = 12345;
    float xf00 = noiseLerp(xs, fnlGradCoord3d( x0, y0, z0, xf0, yf0, zf0, seed), fnlGradCoord3d( x1, y0, z0, xf1, yf0, zf0, seed));
    float xf10 = noiseLerp(xs, fnlGradCoord3d( x0, y1, z0, xf0, yf1, zf0, seed), fnlGradCoord3d( x1, y1, z0, xf1, yf1, zf0, seed));
    float xf01 = noiseLerp(xs, fnlGradCoord3d( x0, y0, z1, xf0, yf0, zf1, seed), fnlGradCoord3d( x1, y0, z1, xf1, yf0, zf1, seed));
    float xf11 = noiseLerp(xs, fnlGradCoord3d( x0, y1, z1, xf0, yf1, zf1, seed), fnlGradCoord3d( x1, y1, z1, xf1, yf1, zf1, seed));

    float yf00 = noiseLerp(ys, xf00, xf10);
    float yf01 = noiseLerp(ys, xf01, xf11);

    return noiseLerp(zs, yf00, yf01) * 0.964921414852142333984375f;
}


float fnlPerlin2d(vec2 vec, int seed = 12345){
    int x0 = vec.x >= 0 ? (int)vec.x : ((int)vec.x - 1); 
    int y0 = vec.y >= 0 ? (int)vec.y : ((int)vec.y - 1);
    float xf0 = (float)(vec.x - x0); 
    float yf0 = (float)(vec.y - y0); 
    float xf1 = xf0 - 1;
    float yf1 = yf0 - 1;
    
    float xs = noiseFade(xf0);
    float ys = noiseFade(yf0);

    x0 *= PRIME_X;
    y0 *= PRIME_Y;
    
    int x1 = x0 + PRIME_X;
    int y1 = y0 + PRIME_Y;

    float xf00 = noiseLerp(xs, fnlGradCoord2d( x0, y0, xf0, yf0, seed), fnlGradCoord2d( x1, y0, xf1, yf0, seed));
    float xf01 = noiseLerp(xs, fnlGradCoord2d( x0, y1, xf0, yf1, seed), fnlGradCoord2d( x1, y1, xf1, yf1, seed));

    return noiseLerp(ys, xf00, xf01) * 1.4247691104677813f;
} 


void noise_test(){
float scale = 0.009953125f; //for larger scale
// float scale = 1.0f/512.0f;
//do we need to scale the outputs with (+1.0f)*0.5f;?

// float result00 = fnlPerlin2d({0.0f     , 0.0f        });
// float result01 = fnlPerlin2d({0.0f     , 1.0f * scale});
// float result02 = fnlPerlin2d({0.0f     , 2.0f * scale});
// printf("result00: %f\n", (result00+1.0f)*0.5f);
// printf("result01: %f\n", (result01+1.0f)*0.5f);
// printf("result02: %f\n", (result02+1.0f)*0.5f);

for(int y = 0; y < 512; y++){
    printf("y %d : %f\n", y, (fnlPerlin2d({0.0f, y * scale})+1.0f)*0.5f);
}

}